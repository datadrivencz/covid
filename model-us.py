#!/usr/bin/env python3

import math
import scipy.optimize as optimize

from lib import *

STEP_DAYS = 5
POPULATION = 330000000

numTests = [
  55594.4285714286,
  63805,
  65905.2857142857,
  65777.8571428571,
  62732.5714285714,
  56689,
  51968,
  52560.1428571429,
  45980.2857142857,
  41215.2857142857,
  41122.8571428571,
  40493.1428571429,
  36476.8571428571,
  34989.4285714286,
  39734.4285714286,
  42556.8571428572,
  41701.8571428571,
  42931.7142857143,
  46852.4285714286,
  51850.4285714286,
  56922.4285714286,
  66342.4285714286,
  75975.5714285714,
  85173,
  107547.142857143,
  136440.571428571,
  158000,
  169058.285714286]

numDeaths = [
  665.714285714286,
  707.857142857143,
  793.857142857143,
  912.428571428571,
  1118.14285714286,
  1054.14285714286,
  1045.14285714286,
  1069.57142857143,
  1030.42857142857,
  966.857142857143,
  918.714285714286,
  854.714285714286,
  728.857142857143,
  747.714285714286,
  789.857142857143,
  741.285714285714,
  728,
  692.428571428571,
  694.142857142857,
  685.428571428571,
  708.285714285714,
  807.857142857143,
  796.857142857143,
  909.428571428571,
  1003.14285714286,
  1069.71428571429,
  1211.42857142857,
  1525.71428571429]

positivePct = [
  0.075504126887962,
  0.077237891157903,
  0.077948753091087,
  0.075082645333765,
  0.07031991623985,
  0.068122610735097,
  0.065063873218275,
  0.066148983116431,
  0.055890679392553,
  0.052442697939808,
  0.050887706632186,
  0.047371994028899,
  0.044440647403424,
  0.047466881439692,
  0.047011238537684,
  0.043711077687601,
  0.040163329390916,
  0.041190828478089,
  0.044468111176949,
  0.046380926443752,
  0.050495990599673,
  0.058088449107242,
  0.062147577127549,
  0.068445093501436,
  0.079735260243606,
  0.095806737397725,
  0.102163773511512,
  0.097109461654664]

hospitalized = [
  44394.1428571429,
  54188.7142857143,
  57801,
  59236,
  57609.8571428572,
  54366.1428571429,
  51209,
  47401.7142857143,
  43882.5714285714,
  40376,
  37530,
  35303.8571428571,
  33068.2857142857,
  31289.4285714286,
  29821,
  29329.4285714286,
  29826.5714285714,
  30368.7142857143,
  32366.7142857143,
  35205.7142857143,
  37052.1428571429,
  39737.2857142857,
  43347.4285714286,
  47361.8571428572,
  53092,
  62123.2857142857,
  72043,
  81707.7142857143]

if len(sys.argv) > 1:
  idx = int(sys.argv[1])
  numTests = numTests[-idx:]
  numDeaths = numDeaths[-idx:]
  positivePct = positivePct[-idx:]
  hospitalized = hospitalized[-idx:]

params, paramRanges, scales = computeInitialParams(numTests, positivePct, hospitalized, numDeaths, POPULATION, STEP_DAYS)

runOptimization(params, paramRanges, scales, (numTests, positivePct, numDeaths, hospitalized), w = (2.0, 2.0, 3.0, 0.5))
