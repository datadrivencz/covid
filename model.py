#!/usr/bin/env python3

import sys
import math
import scipy.optimize as optimize

from lib import *

STEP_DAYS = 5
POPULATION = 10700000

numTests = [
  224,
  233.142857142857,
  246.142857142857,
  281.857142857143,
  329.857142857143,
  450.571428571429,
  679.142857142857,
  1147.57142857143,
  1770.85714285714,
  2061.85714285714,
  2159.71428571429,
  2474.71428571429,
  3785.71428571429,
  5674.28571428571,
  8110.85714285714,
  11173.2857142857,
  12585,
  11788.2857142857,
  10872.7142857143,
  7820.14285714286,
  5599.14285714286,
  4592]

numDeaths = [
  1,
  0.857142857142857,
  2,
  1.85714285714286,
  1.71428571428571,
  1.42857142857143,
  3.14285714285714,
  4.14285714285714,
  7.57142857142857,
  11.4285714285714,
  13.5714285714286,
  18,
  29.5714285714286,
  50.1428571428571,
  69.5714285714286,
  106.142857142857,
  149.142857142857,
  197.285714285714,
  213.714285714286,
  188.714285714286,
  160.285714285714,
  128]

positivePct = [
  0.042028571428572,
  0.043657142857143,
  0.046557142857143,
  0.051514285714286,
  0.053385714285714,
  0.059914285714286,
  0.078285714285714,
  0.1073,
  0.130857142857143,
  0.136757142857143,
  0.145585714285714,
  0.164185714285714,
  0.219314285714286,
  0.271071428571429,
  0.295814285714286,
  0.332528571428571,
  0.352685714285714,
  0.343857142857143,
  0.337314285714286,
  0.2945,
  0.267542857142857,
  0.228671428571429]

hospitalized = [
  109.142857142857,
  107.428571428571,
  108,
  117,
  139.142857142857,
  168.285714285714,
  208.571428571429,
  271.142857142857,
  391.428571428571,
  559,
  756.285714285714,
  1023.28571428571,
  1458,
  2164.57142857143,
  3125.14285714286,
  4408,
  5819.28571428572,
  7204.85714285714,
  7962,
  7799.85714285714,
  6927.28571428571,
  6124.28571428571]

if len(sys.argv) > 1:
  idx = int(sys.argv[1])
  numTests = numTests[-idx:]
  numDeaths = numDeaths[-idx:]
  positivePct = positivePct[-idx:]
  hospitalized = hospitalized[-idx:]

params, paramRanges, scales = computeInitialParams(numTests, positivePct, hospitalized, numDeaths, POPULATION, STEP_DAYS)

runOptimization(params, paramRanges, scales, (numTests, positivePct, numDeaths, hospitalized))
