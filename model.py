#!/usr/bin/env python3

import sys
import math
import scipy.optimize as optimize

from libsimple import *

STEP_DAYS = 5
POPULATION = 10700000

numTests = [
  224,
  233.142857142857,
  246.142857142857,
  281.857142857143,
  329.857142857143,
  450.571428571429,
  318.714285714286,
  650.714285714286,
  1119.71428571429,
  1368.71428571429,
  1569.85714285714,
  1956,
  3059.14285714286,
  4575.14285714286,
  6581.85714285714,
  9530.42857142857,
  10964.4285714286,
  10302.2857142857,
  9626.85714285714,
  6981.42857142857,
  4958.14285714286,
  4055.14285714286,
  3549.42857142857,
  3186.57142857143,
  3501.42857142857,
  4266.42857142857,
  5199.28571428572,
  6458.28571428571,
  7428.85714285714,
  8399.85714285714,
  9370.85714285714,
  10600,
  7209.71428571429]

numDeaths = [
  1,
  0.857142857142857,
  2,
  1.85714285714286,
  1.42857142857143,
  1.42857142857143,
  3.28571428571429,
  4.14285714285714,
  7.57142857142857,
  11.4285714285714,
  13.5714285714286,
  18.1428571428571,
  30.4285714285714,
  50.7142857142857,
  70.4285714285714,
  108.285714285714,
  152.428571428571,
  202.142857142857,
  219.571428571429,
  195.142857142857,
  167.285714285714,
  137.428571428571,
  127.142857142857,
  115.571428571429,
  100.571428571429,
  94.7142857142857,
  108.857142857143,
  104.428571428571,
  108.142857142857,
  130.714285714286,
  147.428571428571,
  169,
  175.857142857143]


positivePct = [
  0.042028571428572,
  0.043657142857143,
  0.046557142857143,
  0.051514285714286,
  0.053385714285714,
  0.059914285714286,
  0.038331174819087,
  0.063807256539738,
  0.086923485431749,
  0.095157742136237,
  0.110205622045453,
  0.134396609004789,
  0.185009892579683,
  0.230675632102086,
  0.254226395907887,
  0.298216161219859,
  0.321889057044817,
  0.314127506834717,
  0.310670759236472,
  0.271489805688394,
  0.24439973521751,
  0.206032667557098,
  0.188859254471764,
  0.175503530396292,
  0.192036245658282,
  0.199578212941696,
  0.213423205821403,
  0.241082665992038,
  0.292152734540622,
  0.343222803089205,
  0.394292871637789,
  0.341222713871136,
  0.271334134126]

hospitalized = [
  109.142857142857,
  107.428571428571,
  108,
  117,
  139.142857142857,
  168.285714285714,
  209.571428571429,
  273.428571428571,
  387.571428571429,
  572.571428571429,
  771,
  1047.85714285714,
  1510.42857142857,
  2213.42857142857,
  3152.42857142857,
  4449.71428571429,
  5827.71428571429,
  7249.57142857143,
  7904.57142857143,
  7484.57142857143,
  6679.42857142857,
  6009.42857142857,
  5330.28571428572,
  4742.57142857143,
  4432.42857142857,
  4422.42857142857,
  4577.14285714286,
  4616,
  4532.85714285714,
  5476.28571428572,
  6536.42857142857,
  7185.85714285714,
  7096.42857142857]

agTests = [
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0.019052219718897,
  0.024235589716196,
  0.030461523159047,
  0.032272426364323,
  0.03190105626696,
  0.036316418517718,
  0.051768913593184,
  0.054337901087604,
  0.047996197162498, 
  0.036689862554386]

if len(sys.argv) > 1:
  idx = int(sys.argv[1])
  numTests = numTests[-idx:]
  numDeaths = numDeaths[-idx:]
  positivePct = positivePct[-idx:]
  hospitalized = hospitalized[-idx:]

params, paramRanges, scales = computeInitialParams(numTests, positivePct, hospitalized, numDeaths, POPULATION, STEP_DAYS, agTests)

runOptimization(params, paramRanges, scales, (numTests, positivePct, numDeaths, hospitalized, agTests), w = (1.0, 1.5, 1.0, .2, 2.0, 3.0))
