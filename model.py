#!/usr/bin/env python3

import sys
import math
import scipy.optimize as optimize

from libsimple import *

STEP_DAYS = 5
POPULATION = 10700000

numTests = [
  224,
  233.142857142857,
  246.142857142857,
  281.857142857143,
  329.857142857143,
  450.571428571429,
  679.142857142857,
  1147.57142857143,
  1770.85714285714,
  2061.85714285714,
  2159.71428571429,
  2474.71428571429,
  3785.71428571429,
  5674.28571428571,
  8110.85714285714,
  11173.2857142857,
  12585,
  11788.2857142857,
  10872.7142857143,
  7820.14285714286,
  5599.14285714286,
  4592,
  4052.71428571429,
  3651.42857142857,
  3967.42857142857,
  4760.42857142857,
  5829.28571428571,
  7459.14285714286,
  6677,
  9691.57142857143]

numDeaths = [
  1,
  0.857142857142857,
  2,
  1.85714285714286,
  1.42857142857143,
  1.42857142857143,
  3.28571428571429,
  4.14285714285714,
  7.57142857142857,
  11.4285714285714,
  13.5714285714286,
  18.1428571428571,
  30.4285714285714,
  50.7142857142857,
  70.4285714285714,
  108.285714285714,
  152.285714285714,
  202.142857142857,
  219.857142857143,
  195.285714285714,
  167,
  137.285714285714,
  127.428571428571,
  115.142857142857,
  100.285714285714,
  93.2857142857143,
  105.857142857143,
  100.571428571429,
  104.285714285714,
  119.142857142857]
  
positivePct = [
  0.042028571428572,
  0.043657142857143,
  0.046557142857143,
  0.051514285714286,
  0.053385714285714,
  0.059914285714286,
  0.078285714285714,
  0.1073,
  0.130857142857143,
  0.136757142857143,
  0.145585714285714,
  0.164185714285714,
  0.219314285714286,
  0.271071428571429,
  0.295814285714286,
  0.332528571428571,
  0.352685714285714,
  0.343857142857143,
  0.337314285714286,
  0.2945,
  0.267542857142857,
  0.227114285714286,
  0.210014285714286,
  0.196085714285714,
  0.212171428571429,
  0.217657142857143,
  0.233271428571429,
  0.268428571428571,
  0.342214285714286,
  0.433614285714286]

hospitalized = [
  109.142857142857,
  107.428571428571,
  108,
  117,
  139.142857142857,
  168.285714285714,
  209.571428571429,
  273.428571428571,
  387.571428571429,
  572.571428571429,
  771,
  1047.85714285714,
  1510.42857142857,
  2213.42857142857,
  3152.42857142857,
  4449.71428571429,
  5827.71428571429,
  7249.57142857143,
  7904.57142857143,
  7484.57142857143,
  6679.42857142857,
  6009.42857142857,
  5330.28571428572,
  4742.57142857143,
  4432.42857142857,
  4422.42857142857,
  4577.14285714286,
  4616,
  4532.85714285714,
  5418.85714285714]

if len(sys.argv) > 1:
  idx = int(sys.argv[1])
  numTests = numTests[-idx:]
  numDeaths = numDeaths[-idx:]
  positivePct = positivePct[-idx:]
  hospitalized = hospitalized[-idx:]

params, paramRanges, scales = computeInitialParams(numTests, positivePct, hospitalized, numDeaths, POPULATION, STEP_DAYS)

runOptimization(params, paramRanges, scales, (numTests, positivePct, numDeaths, hospitalized), w = (1.0, 1.5, 1.0, .5, 0.5))
